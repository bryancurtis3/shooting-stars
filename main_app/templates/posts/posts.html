{% extends 'base.html' %}
{% load static %}
{% load sass_tags %}

{% block styles %}
<link rel="stylesheet" href="{% sass_src 'styles/posts/posts.scss'%}">
{% endblock styles %}

{% block scripts %}
<script src="{% static 'scripts/posts.js'%}" defer></script>
{% endblock scripts %}


{% block content %}


<section class="header">

    <a href="/posts/">All Posts</a>

    <form class="search" action="/posts" method="GET">
        <input 
        name="q"
        {% comment %} class="search" {% endcomment %}
        type="search" 
        placeholder="Search by coordinates"
        title="e.g: -54.321, 12.345"
        >
    </form>

</section>

<section class="new-post" onClick="modal()" title="New Post">
    <i class="fas fa-plus" ></i>
</section>

<!-- Posts container -->
<section class="posts">



    {% for post in posts  %}

    <!-- Post display -->
    <article class="post">
        <a class="title" href="/posts/{{post.pk}}" title="Go to post">{{post.title}}</a>
        <div class="subtitle">
            <h4>{{post.user.username}}</h4>
            <p class="coords">{{post.lat}}, {{post.long}}</p>
        </div>
        <a href="{{post.image}}" target="_blank" title="See full sized image">
            <img src="{{post.image}}" alt="Post image">
        </a>
        <p class="description">
            {{post.description|truncatechars:"150"}}
            {% if post.description|length > 150 %}
                <span id="more" class="more">more</span>
            {% endif %}
        </p>
        <p class="description-full">
            {{post.description}}
            <span class="more">less</span>
        </p>
        
    </article>


    {% endfor %}
</section>

<!-- New Post Modal -->
<div class="overlay" onClick="modal()"></div>
<form class="modal" action="{% url 'post_create' %}" method="POST">
    <h3>Create A Post</h3>
    {% csrf_token %}
    {{form.as_p}}
    <div class="buttons">
        <button onClick="modal()">Cancel</button>
        <input class="button" type="submit" value="Submit"></input>
    </div>
</form>


<!-- Alert message (currently for deletion) -->
{% if messages %}
    {% for message in messages %}
        <section class="message">
            <p>{{message}}</p>
            <i class="fas fa-times" onClick="message()"></i>
        </section>
    {% endfor %}
{% endif %}

{% endblock content %}